<!DOCTYPE html> <); ctx.fillStyle = gradient; ctx.fillRect(0, 0, w, h); const pos = (hsb.b / 100) * w; ctx.beginPath(); ctx.arc(pos, h/2, 8, 0, Math.PI*2); ctx.fillStyle = "#fff"; ctx.strokeStyle = "#000"; ctx.lineWidth = 2; ctx.fill(); ctx.stroke(); } function drawAll() { drawHueGradient(); drawSaturationGradient(); drawBrightnessGradient(); sliders.forEach(sl => { sl.valueDisplay.textContent = Math.round(hsb[sl.name]); }); } function updatePreview() { const rgb = HSBtoRGB(hsb.h, hsb.s, hsb.b); const hex = rgbToHex(rgb.r, rgb.g, rgb.b); previewBox.style.backgroundColor = hex; hexOutput.value = hex; color = hex; // 現在の色更新 } function updateByPointer(slider, e) { const rect = slider.canvas.getBoundingClientRect(); let x = e.clientX - rect.left; if(x < 0) x = 0; if(x > slider.width) x = slider.width; if(slider.name === "h") { hsb.h = (x / slider.width) * 360; } else { hsb[slider.name] = (x / slider.width) * 100; } drawAll(); updatePreview(); } let dragging = null; sliders.forEach(slider => { slider.canvas.addEventListener("mousedown", e => { dragging = slider; updateByPointer(slider, e); window.addEventListener("mousemove", onMouseMove); window.addEventListener("mouseup", onMouseUp); }); slider.canvas.addEventListener("touchstart", e => { dragging = slider; updateByPointer(slider, e.touches[0]); window.addEventListener("touchmove", onTouchMove, { passive:false }); window.addEventListener("touchend", onTouchEnd); }); }); function onMouseMove(e) { if(!dragging) return; updateByPointer(dragging, e); } function onMouseUp(e) { dragging = null; window.removeEventListener("mousemove", onMouseMove); window.removeEventListener("mouseup", onMouseUp); } function onTouchMove(e) { e.preventDefault(); if(!dragging) return; updateByPointer(dragging, e.touches[0]); } function onTouchEnd() { dragging = null; window.removeEventListener("touchmove", onTouchMove); window.removeEventListener("touchend", onTouchEnd); } // 初期化 hsb.h = 0; hsb.s = 100; hsb.b = 100; drawAll(); updatePreview(); // ===== デフォルトカラーの生成と反映 ===== const defaultColors = [ "#E63946", "#F1A7B3", "#F4A261", "#FFD166", "#2A9D8F", "#264653", "#A8DADC", "#6C757D", "#1D1D1D", "#F0F0F0" ]; const defaultColorsContainer = document.getElementById("defaultColors"); defaultColors.forEach(colorValue => { const div = document.createElement("div"); div.className = "color-circle"; div.style.backgroundColor = colorValue; div.title = colorValue; div.addEventListener("click", () => { color = colorValue; hexOutput.value = colorValue; previewBox.style.backgroundColor = colorValue; }); defaultColorsContainer.appendChild(div); }); drawGrid(); // グローバル関数登録 window.undo = undo; window.redo = redo; window.saveImage = saveImage; window.saveSVG = saveSVG; window.selectTool = selectTool; })(); window.addEventListener("beforeunload", (event) => { saveProjectToLocal(); // Cancel the event as stated by the standard. event.preventDefault(); // Chrome requires returnValue to be set. event.returnValue = "データを復元することはできません。本当に閉じますか？"; }); </script> <script> window.onload = function() { const spinner = document.getElementById('loading'); spinner.classList.add('loaded'); } </script> </body> </html>
